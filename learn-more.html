<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Under the Hood - WireClaw</title>
  <meta name="description" content="How a $5 ESP32 chip runs 20 tools, a rule engine, rule chains, and an AI agent. Architecture, tools, LED feedback, and technical specs.">
  <meta name="author" content="Mario Schallner">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://wireclaw.io/learn-more.html">
  <meta property="og:title" content="Under the Hood - WireClaw">
  <meta property="og:description" content="How a $5 ESP32 chip runs 20 tools, a rule engine, rule chains, web config, and an AI agent. Architecture, tools, and technical specs.">
  <meta property="og:image" content="https://wireclaw.io/assets/preview.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="WireClaw">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Under the Hood - WireClaw">
  <meta name="twitter:description" content="How a $5 ESP32 chip runs 20 tools, a rule engine, rule chains, and an AI agent.">
  <meta name="twitter:image" content="https://wireclaw.io/assets/preview.png">
  <!-- Theme -->
  <meta name="theme-color" content="#00d4aa">
  <link rel="canonical" href="https://wireclaw.io/learn-more.html">
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/landing.css">
  <link rel="stylesheet" href="css/learn-more.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>

  <!-- Navigation -->
  <header class="site-header">
    <div class="container">
      <a href="/" class="logo" aria-label="WireClaw home">
        <img src="assets/logo.svg" width="32" height="32" alt="" aria-hidden="true">
        <span>WireClaw</span>
      </a>
      <nav class="nav-links" aria-label="Main navigation">
        <a href="learn-more.html">Learn More</a>
        <a href="architecture.html">Architecture</a>
        <a href="examples.html">Examples</a>
        <a href="config-portal/">Web UI</a>
        <a href="https://github.com/M64GitHub/WireClaw" target="_blank" rel="noopener" class="btn btn-outline btn-sm">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
          GitHub
        </a>
        <a href="flash.html" class="btn btn-outline btn-sm">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          Flash Now
        </a>
      </nav>
      <button class="hamburger" aria-label="Toggle menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <h1 class="reveal">Under the <span class="accent">Hood</span></h1>
      <p class="reveal" style="--stagger: 1">How a $5 chip runs 20 tools, a rule engine, rule chains, and an AI agent. Cloud optional.</p>
    </div>
  </section>

  <!-- Architecture Deep Dive -->
  <section class="architecture-deep">
    <div class="container">
      <div class="section-header reveal">
        <h2>Dual-Loop <span class="accent">Architecture</span></h2>
        <p>Two systems on one chip. The AI creates. The rules execute.</p>
      </div>
      <div class="arch-steps">
        <div class="arch-step reveal" style="--stagger: 0">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
          </div>
          <div>
            <h3>Two Loops, One Chip</h3>
            <p>The main <code>loop()</code> runs two systems. The Rule Loop evaluates automation rules every iteration - no network, no latency. The AI Loop activates only when a message arrives via Telegram, serial, or NATS.</p>
          </div>
        </div>
        <div class="arch-step reveal" style="--stagger: 1">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          </div>
          <div>
            <h3>Rule Engine</h3>
            <p>Persistent automation. Reads sensors, checks conditions (<code>gt</code>, <code>lt</code>, <code>eq</code>, <code>neq</code>, <code>change</code>, <code>always</code>), fires actions (actuator, LED, GPIO, NATS, Telegram, Serial). Edge-triggered conditions fire once per transition, then auto-reset. Chain rules together with delays via <code>chain_create</code>. Message interpolation: <code>{value}</code>, <code>{device_name}</code>, <code>{name:msg}</code>. Survives reboots.</p>
          </div>
        </div>
        <div class="arch-step reveal" style="--stagger: 2">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 2a7 7 0 017 7c0 5-7 11-7 11S5 14 5 9a7 7 0 017-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
          </div>
          <div>
            <h3>AI Loop</h3>
            <p>LLM via OpenRouter, Ollama, llama.cpp, or any OpenAI-compatible endpoint. HTTPS for cloud, HTTP for local (saves ~40% RAM). 20 tools. Up to 5 iterations per request. Creates rules, registers devices, reads sensors, writes files. The AI is the compiler - it turns intent into persistent automation.</p>
          </div>
        </div>
        <div class="arch-step reveal" style="--stagger: 3">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="2" y="3" width="20" height="18" rx="2"/><path d="M8 7h8M8 11h5M8 15h8"/></svg>
          </div>
          <div>
            <h3>Device Registry</h3>
            <p>Named sensors and actuators persisted to flash. Register once, reference by name everywhere. <code>chip_temp</code> is pre-registered on first boot. Eight sensor types, three actuator types. Clock sensors auto-register on boot.</p>
          </div>
        </div>
        <div class="arch-step reveal" style="--stagger: 4">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          </div>
          <div>
            <h3>Time-Based Automation</h3>
            <p>Virtual clock sensors (<code>clock_hour</code>, <code>clock_minute</code>, <code>clock_hhmm</code>) auto-register on boot. NTP-synced with timezone and DST. Schedule anything - the same rule engine that watches temperature can watch the clock.</p>
          </div>
        </div>
        <div class="arch-step reveal" style="--stagger: 5">
          <div class="arch-step-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="5" cy="12" r="3"/><circle cx="19" cy="5" r="3"/><circle cx="19" cy="19" r="3"/><path d="M8 12h4M15.5 7l-3.5 3M15.5 17l-3.5-3"/></svg>
          </div>
          <div>
            <h3>NATS Mesh Communication</h3>
            <p>Devices talk to each other over NATS. Register <code>nats_value</code> sensors that subscribe to external subjects and feed data into the rule engine. The <code>remote_chat</code> tool lets one device's AI ask another a natural language question. Publish sensor data, trigger cross-device rules, build a mesh of $5 autonomous agents.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Inputs & Outputs -->
  <section class="io-reference">
    <div class="container">
      <div class="section-header reveal">
        <h2>Inputs &amp; <span class="accent">Outputs</span></h2>
        <p>What it can read, what it can control, and how rules react.</p>
      </div>

      <h3 class="reveal" style="text-align: center; margin-bottom: var(--space-xl);">Sensor Types (10)</h3>
      <div class="ref-grid reveal" style="--stagger: 0">
        <div class="ref-card">
          <div class="ref-card-name">digital_in</div>
          <p>Digital input pin. Returns HIGH (1) or LOW (0).</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">analog_in</div>
          <p>Analog input via ADC. Returns raw value (0-4095).</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">ntc_10k</div>
          <p>10K NTC thermistor. Automatic temperature conversion.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">ldr</div>
          <p>Light-dependent resistor. Returns light level reading.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">internal_temp</div>
          <p>Chip's internal temperature sensor. No external hardware needed.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">nats_value</div>
          <p>NATS-subscribed sensor. Receives values from any NATS subject. No GPIO pin.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">serial_text</div>
          <p>Text lines from UART1 serial port. Connects Arduinos, GPS, CO2 sensors. One device max.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">clock_hour</div>
          <p>Current hour (0-23). NTP-synced, POSIX timezone + DST.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">clock_minute</div>
          <p>Current minute (0-59). Updates every rule evaluation cycle.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">clock_hhmm</div>
          <p>Combined time as hour*100+minute (e.g., 1830 = 6:30 PM).</p>
        </div>
      </div>

      <h3 class="reveal" style="text-align: center; margin-top: var(--space-3xl); margin-bottom: var(--space-xl);">Actuator Types (3)</h3>
      <div class="ref-grid reveal" style="--stagger: 1; grid-template-columns: repeat(3, 1fr);">
        <div class="ref-card">
          <div class="ref-card-name">digital_out</div>
          <p>Digital output pin. Set HIGH or LOW.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">relay</div>
          <p>Relay control. On/off switching with optional inverted logic.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">pwm</div>
          <p>PWM output. Variable duty cycle for dimmers, motors, servos.</p>
        </div>
      </div>

      <h3 class="reveal" style="text-align: center; margin-top: var(--space-3xl); margin-bottom: var(--space-xl);">Rule Action Types (6)</h3>
      <div class="ref-grid reveal" style="--stagger: 2; grid-template-columns: repeat(3, 1fr);">
        <div class="ref-card">
          <div class="ref-card-name">actuator</div>
          <p>Set a registered actuator's value by name. Auto on/off.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">led_set</div>
          <p>Set the onboard RGB LED to any color. Takes R,G,B values.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">gpio_write</div>
          <p>Write HIGH or LOW to a GPIO pin directly.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">nats_publish</div>
          <p>Publish a message to a NATS subject. Rule-triggered device-to-device messaging.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">telegram</div>
          <p>Send a Telegram alert. Configurable cooldown prevents flooding.</p>
        </div>
        <div class="ref-card">
          <div class="ref-card-name">serial_send</div>
          <p>Send text over serial_text UART. Supports <code>{value}</code> and <code>{device_name}</code> interpolation.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Rule Chains -->
  <section class="architecture-deep">
    <div class="container">
      <div class="section-header reveal">
        <h2>Rule <span class="accent">Chains</span></h2>
        <p>Chain up to 5 actions with delays in a single tool call. The AI creates the chain. The firmware runs it.</p>
      </div>

      <div class="loop-flow reveal" style="--stagger: 0; justify-content: center; margin-bottom: var(--space-2xl);">
        <div class="loop-flow-node">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          <span>Sensor</span>
        </div>
        <div class="loop-flow-arrow" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M13 5l7 7-7 7"/></svg>
        </div>
        <div class="loop-flow-node">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          <span>Step 1</span>
        </div>
        <div class="loop-flow-arrow" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M13 5l7 7-7 7"/></svg>
        </div>
        <div class="loop-flow-node" style="border-color: var(--led-orange);">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="var(--led-orange)" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          <span style="color: var(--led-orange);">Delay</span>
        </div>
        <div class="loop-flow-arrow" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M13 5l7 7-7 7"/></svg>
        </div>
        <div class="loop-flow-node">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          <span>Step 2</span>
        </div>
        <div class="loop-flow-arrow" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M13 5l7 7-7 7"/></svg>
        </div>
        <div class="loop-flow-node">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>...</span>
        </div>
      </div>

      <div class="terminal reveal" style="--stagger: 1; max-width: 720px; margin: 0 auto var(--space-2xl);">
        <div class="terminal-header">
          <span class="terminal-dot"></span>
          <span class="terminal-dot"></span>
          <span class="terminal-dot"></span>
          <span class="terminal-title">serial - chain_create via Telegram</span>
        </div>
        <div class="terminal-body" style="min-height: auto; max-height: none; font-size: 0.8rem; line-height: 1.6;">
          <div class="terminal-line user-input" style="color: var(--text-muted); font-weight: 400;">[TG] Message: send me a telegram when test &gt; 100, wait 5s, send "hello test", set LED green, after 10s turn LED off</div>
          <div class="terminal-line spacer"></div>
          <div class="terminal-line thinking">--- Thinking... ---</div>
          <div class="terminal-line tool-call">[Agent] 1 tool call(s) in iteration 1:</div>
          <div class="terminal-line tool-call">  -&gt; chain_create(sensor_name="test", condition="gt", threshold=100,</div>
          <div class="terminal-line tool-call">       step1_action="telegram", step1_message="Test exceeded 100: {value}",</div>
          <div class="terminal-line tool-call">       step2_action="telegram", step2_delay=5, step2_message="hello test",</div>
          <div class="terminal-line tool-call">       step3_action="led_set", step3_r=0, step3_g=255, step3_b=0,</div>
          <div class="terminal-line tool-call">       step4_action="led_set", step4_delay=10, step4_r=0, step4_g=0, step4_b=0)</div>
          <div class="terminal-line result">     = Chain created: rule_04 test&gt;100 -&gt; telegram -&gt; 5s -&gt; telegram -&gt; LED(0,255,0) -&gt; 10s -&gt; LED(0,0,0)</div>
        </div>
      </div>

      <div style="text-align: center; margin-top: var(--space-xl);">
        <a href="architecture.html#chain-internals" class="arch-link reveal" style="--stagger: 2">Chain internals &rarr;</a>
      </div>
    </div>
  </section>

  <!-- 20 Tools -->
  <section class="tools-section">
    <div class="container">
      <div class="section-header reveal">
        <h2>20 <span class="accent">Tools</span></h2>
        <p>Each tool maps to a real hardware or system capability.</p>
      </div>
      <div class="tools-summary reveal">
        <div class="tools-summary-row">
          <span class="tools-summary-label">Hardware (4)</span>
          <span class="tools-summary-list"><code>led_set</code>, <code>gpio_write</code>, <code>gpio_read</code>, <code>temperature_read</code></span>
        </div>
        <div class="tools-summary-row">
          <span class="tools-summary-label">Device Registry (5)</span>
          <span class="tools-summary-list"><code>device_register</code>, <code>device_list</code>, <code>device_remove</code>, <code>sensor_read</code>, <code>actuator_set</code></span>
        </div>
        <div class="tools-summary-row">
          <span class="tools-summary-label">Rule Engine (5)</span>
          <span class="tools-summary-list"><code>rule_create</code>, <code>rule_list</code>, <code>rule_delete</code>, <code>rule_enable</code>, <code>chain_create</code></span>
        </div>
        <div class="tools-summary-row">
          <span class="tools-summary-label">System (3)</span>
          <span class="tools-summary-list"><code>device_info</code>, <code>file_read</code>, <code>file_write</code></span>
        </div>
        <div class="tools-summary-row">
          <span class="tools-summary-label">Messaging (3)</span>
          <span class="tools-summary-list"><code>nats_publish</code>, <code>serial_send</code>, <code>remote_chat</code></span>
        </div>
      </div>
      <div style="text-align: center; margin-top: var(--space-xl);">
        <a href="architecture.html#tools" class="arch-link reveal" style="--stagger: 1">Full tool reference →</a>
      </div>
    </div>
  </section>

  <!-- LED Feedback -->
  <section class="led-section">
    <div class="container">
      <div class="section-header reveal">
        <h2>LED <span class="accent">Feedback</span> System</h2>
        <p>The onboard LED tells you what the agent is doing at a glance.</p>
      </div>
      <div class="led-row">
        <div class="led-item">
          <div class="led-circle led-orange" style="--stagger: 0"></div>
          <span class="led-label">Connecting</span>
        </div>
        <div class="led-item">
          <div class="led-circle led-blue" style="--stagger: 1"></div>
          <span class="led-label">Thinking</span>
        </div>
        <div class="led-item">
          <div class="led-circle led-purple" style="--stagger: 2"></div>
          <span class="led-label">Tool Loop</span>
        </div>
        <div class="led-item">
          <div class="led-circle led-green" style="--stagger: 3"></div>
          <span class="led-label">Success</span>
        </div>
        <div class="led-item">
          <div class="led-circle led-red" style="--stagger: 4"></div>
          <span class="led-label">Error</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Conversation Persistence -->
  <section class="persistence-section">
    <div class="container">
      <div class="section-header reveal">
        <h2>Memory That <span class="accent">Survives</span> Reboots</h2>
      </div>

      <h3 class="reveal" style="text-align: center; margin-bottom: var(--space-lg);">Conversation Buffer</h3>
      <p class="reveal" style="text-align: center; max-width: 550px; margin: 0 auto var(--space-xl);">A 6-turn circular buffer stored on flash. Context persists across power cycles.</p>
      <div class="ring-buffer reveal">
        <div class="buffer-slot filled" style="--stagger: 0">U:1</div>
        <div class="buffer-slot filled" style="--stagger: 1">A:1</div>
        <div class="buffer-slot filled" style="--stagger: 2">U:2</div>
        <div class="buffer-slot filled" style="--stagger: 3">A:2</div>
        <div class="buffer-slot filled" style="--stagger: 4">U:3</div>
        <div class="buffer-slot write-head" style="--stagger: 5">A:3</div>
      </div>
      <p class="ring-label reveal" style="--stagger: 6">← oldest ··· newest →  (write head)</p>

      <h3 class="reveal" style="text-align: center; margin-top: var(--space-3xl); margin-bottom: var(--space-lg);">Persistent Memory</h3>
      <p class="reveal" style="text-align: center; max-width: 550px; margin: 0 auto var(--space-xl);">Long-term preferences in <code>/memory.txt</code> on flash. The AI writes autonomously. Injected into every conversation. 512 chars. Survives reboots.</p>
      <div class="reveal" style="max-width: 440px; margin: 0 auto var(--space-xl); font-family: var(--font-mono); font-size: 0.8rem; line-height: 1.8; background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: var(--space-md) var(--space-lg);">
        <div><span style="color: var(--accent);">></span> <span style="color: var(--text-primary);">"My favorite color is blue"</span></div>
        <div style="color: var(--text-muted);">  [writes to /memory.txt]</div>
        <div style="color: var(--led-blue);">  --- reboot ---</div>
        <div><span style="color: var(--accent);">></span> <span style="color: var(--text-primary);">"Set the LED to my favorite color"</span></div>
        <div style="color: var(--led-green);">  LED set to blue (0, 0, 255)</div>
      </div>
      <div class="memory-file reveal">
        <div class="memory-file-header">/memory.txt</div>
        <div class="memory-file-body">User's favorite color is blue.
Prefers Celsius for temperature.
Garden-node is the outdoor sensor.</div>
      </div>
    </div>
  </section>

  <!-- Technical Specs -->
  <section class="specs-section">
    <div class="container">
      <div class="section-header reveal">
        <h2>Technical <span class="accent">Specs</span></h2>
      </div>
      <div class="specs-wrapper reveal">
        <table class="specs-table">
          <tbody>
            <tr><th>MCU</th><td>ESP32-C6, ESP32-S3, ESP32-C3 (4MB flash)</td></tr>
            <tr><th>Framework</th><td>Arduino + PlatformIO</td></tr>
            <tr><th>Language</th><td>C++ (Arduino-flavored)</td></tr>
            <tr><th>RAM Usage</th><td>~280 KB with active conversation</td></tr>
            <tr><th>Tools</th><td>20 built-in (hardware, registry, rules, chains, filesystem, messaging)</td></tr>
            <tr><th>Rule Engine</th><td>7 conditions (incl. always/periodic, chained), 6 action types, edge-triggered, message interpolation ({value}, {device_name}, {name:msg}), /rules.json</td></tr>
            <tr><th>Rule Chaining</th><td><code>chain_create</code> tool, up to 5 steps with non-blocking delays, max depth 8, 672 bytes RAM, persisted to /rules.json</td></tr>
            <tr><th>Device Registry</th><td>10 sensor types (incl. 3 virtual clock, NATS, serial), 3 actuator types, persisted to flash</td></tr>
            <tr><th>Serial Bridge</th><td>UART1, <code>serial_text</code> sensor + <code>serial_send</code> tool/action, 9600-115200 baud, text + JSON parsing</td></tr>
            <tr><th>Clock Sensors</th><td>clock_hour, clock_minute, clock_hhmm - NTP-synced, POSIX timezone + DST</td></tr>
            <tr><th>Telegram Alerts</th><td>Rule-triggered, no LLM, configurable cooldown, long polling, message interpolation</td></tr>
            <tr><th>Persistent Memory</th><td>/memory.txt on flash, 512 char limit, AI-managed</td></tr>
            <tr><th>JSON Parsing</th><td>Streaming token-by-token (ArduinoJson)</td></tr>
            <tr><th>Buffer Strategy</th><td>Chunked HTTP reads, reused scratch buffers</td></tr>
            <tr><th>Flash Storage</th><td>LittleFS partition for config, history, rules, and device registry</td></tr>
            <tr><th>API Protocol</th><td>HTTPS with TLS 1.2, OpenAI-compatible chat completions, or HTTP for local LLMs (Ollama, llama.cpp)</td></tr>
            <tr><th>NATS Support</th><td>Publish, subscribe, request/reply over TCP</td></tr>
            <tr><th>NATS Sensors</th><td>nats_value type - subscribe to external NATS subjects, feed readings into rule engine, no hardware pin needed</td></tr>
            <tr><th>Local LLM</th><td>Ollama, llama.cpp, any OpenAI-compatible endpoint. HTTP mode saves ~40% RAM. No API key needed.</td></tr>
            <tr><th>Configuration</th><td>JSON config on flash - WiFi, API key, model, system prompt</td></tr>
            <tr><th>Web Config</th><td>Browser UI at <code>http://device.local/</code> &mdash; config, prompt, memory, status. REST API for scripting.</td></tr>
            <tr><th>History Buffer</th><td>6-turn circular buffer persisted to flash</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Getting Started -->
  <section class="getting-started">
    <div class="container">
      <div class="section-header reveal">
        <h2>Getting <span class="accent">Started</span></h2>
        <p>Three steps from zero to a working AI agent.</p>
      </div>
      <div class="steps-list">
        <div class="step-card reveal" style="--stagger: 0">
          <div class="step-number">1</div>
          <div>
            <h3>Flash the Firmware</h3>
            <p>Clone the repo and upload with PlatformIO: <code>pio run -t upload</code></p>
          </div>
        </div>
        <div class="step-card reveal" style="--stagger: 1">
          <div class="step-number">2</div>
          <div>
            <h3>Configure on Flash</h3>
            <p>Edit <code>system_prompt.txt</code> and <code>config.json</code> with your WiFi credentials and model. Add an API key for cloud LLMs, or point to a local Ollama endpoint - no key needed. Upload with <code>pio run -t uploadfs</code></p>
          </div>
        </div>
        <div class="step-card reveal" style="--stagger: 2">
          <div class="step-number">3</div>
          <div>
            <h3>Talk to It</h3>
            <p>Send natural language via Telegram, serial console, or NATS - the agent handles the rest.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Web Config Portal -->
  <section class="architecture-deep">
    <div class="container">
      <div class="section-header reveal">
        <h2>Web <span class="accent">Config</span> Portal</h2>
        <p>Change config, prompt, and memory from any browser &mdash; no USB, no reflashing. REST API for automation.</p>
      </div>
      <div style="text-align: center;">
        <a href="config-portal/" class="btn btn-outline reveal" style="--stagger: 1">Try the Demo &rarr;</a>
      </div>
    </div>
  </section>

  <!-- GitHub CTA -->
  <section class="github-cta">
    <div class="container">
      <h2 class="reveal">Ready to Put AI on the <span class="accent">Wire</span>?</h2>
      <div class="hero-ctas" style="justify-content: center;">
        <a href="flash.html" class="btn btn-primary reveal" style="--stagger: 1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          Flash Now
        </a>
        <a href="architecture.html" class="btn btn-outline reveal" style="--stagger: 2">Dive Deeper &rarr;</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-logo">
        <img src="assets/logo.svg" width="28" height="28" alt="" aria-hidden="true">
        <span>WireClaw</span>
      </div>
      <nav class="footer-links" aria-label="Footer navigation">
        <a href="/">Home</a>
        <a href="architecture.html">Architecture</a>
        <a href="examples.html">Examples</a>
        <a href="flash.html">Flash Firmware</a>
        <a href="config-portal/">Web UI</a>
        <a href="https://github.com/M64GitHub/WireClaw" target="_blank" rel="noopener">GitHub</a>
      </nav>
      <span class="footer-copy">&copy; 2026 Mario Schallner</span>
    </div>
  </footer>

  <script defer src="js/nav.js"></script>
  <script defer src="js/scroll-reveal.js"></script>
</body>
</html>
